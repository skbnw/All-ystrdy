headline,mainEntityOfPage,image,datePublished,dateModified,author,media_en,media_jp,str_count,body,images,external_links
「第5世代Xeonスケーラブルプロセッサ」はどう変わったのか？　その秘密を技術解説する（ITmedia PC USER）,https://news.yahoo.co.jp/articles/44052e0531e2693572a2ba82d9c737d3a9babf39,https://newsatcl-pctr.c.yimg.jp/t/amd-img/20231229-00000045-zdn_pc-000-1-view.jpg?exp=10800,2023-12-29T12:00:00+09:00,2023-12-29T12:05:10+09:00,ITmedia PC USER,zdn_pc,ITmedia PC USER,9681,\n第5世代Xeon SP（XCCパッケージ）の現物写真。ヒートスプレッダを取り外すと、2基のダイが姿を見せる\n既報の通り、Intelは12月14日に「第5世代Xeon スケーラブルプロセッサ」（開発コード名：Emerald Rapids）を発表した。搭載製品は2024年1～3月から順次発売される予定だ。\n【写真】500円硬貨と並べてみた図\n本稿では、本製品のアーキテクチャ面における注目ポイントや、先代からの強化点などを解説する。なお、本稿は2023年11月末に行われた「Intel Data Center Workshop 2023」の内容を元にしている。\nそもそも「第5世代Xeonスケーラブルプロセッサ」ってどういうもの？\n第5世代Xeonスケーラブルプロセッサ（以下「第5世代Xeon SP」）は、Intel 7（10nm相当）プロセスで生産されたサーバ／データセンター向けCPUだ。先代の「第4世代Xeonスケーラブルプロセッサ」（開発コード名：Sapphire Rapids）と同じ製造プロセスで、CPUソケットも同じ「FCLGA4677」なので、第5世代Xeon SPは「第4世代のマイナーチェンジモデル」ともいえる。\n\n しかし、その中身を子細に見ていくと、大幅な物理設計改変が行われている。ある意味で“ビッグマイナーチェンジ”ともいえるため、見どころは多い。\n\n その概要説明では、先代からの移行はもちろん、第3世代製品（開発コード名：Ice Lake）からのプラットフォーム刷新を促す製品としてのアピールが強く感じられた。\n\n 第4世代Xeon SPでは、最大4基のダイ（チップ）で最大60コア構成となる「XCC（Extreme Core Count）」と、1基のダイで最大32コア構成となる「MCC（Medium Core Count）」の2種類のパッケージが用意されていた。しかし、第5世代Xeon SPでは大きく変わっている。\n\n まず上位モデル向けのXCCパッケージは、最大2ダイ／64コア構成に変更された。MCCはシングルダイ／最大32コア構成のミドルレンジモデル向けに継続される一方で、エントリークラスの製品向けにシングルダイ／最大20コア構成の「EE LCC（Energy Efficient Low Core Count）」という新たなパッケージが追加されている。\n\n 第4世代では最大60コア構成だったものが、第5世代では最大64コアになった――ボーッとしていると「あ、4コア増えたのね」という感想しか出てこないが、実は「4ダイで60コア（1ダイ当たり20コア）」から「2ダイで64コア（1ダイ当たり32コア）」と、結構大きな構造変更が行われている。この変更には、それなりの理由がある。\n\n 詳しくは後に示す図を見てほしいのだが、第4世代では4基のダイをリングバス的な内部バスで接続していたのに対して、第5世代では2基のダイの間を幅の広い内部バス（≒多チャンネル）で直結する構造になっている。これにより、反対側のダイが管轄するメモリ空間へのアクセス効率が劇的に改善した。\n\n こういった共有メモリ型のマルチCPU構成における、CPUコア視点におけるメモリへのアクセスメカニズムを「NUMA（Non-uniform Memory Access：不均一なメモリアクセスの仕組み）」という。第5世代Xeon SPの上位モデルは、XCCの構成を変更することでNUMA性能の向上を実現したのだ。\n\n 第4世代Xeon SP（XCCパッケージ）では、4基のダイからのNUMAをそれぞれ個別のノードとして司る「SNC4（Sub-NUMA Clustering 4）」や、2基を1ユニットとして2ノードとしてつかさどる「SNC2」、そしてノードを区別しない「Quad（Quadrant）」がサポートされていた。それに対して、2ダイ構成となった第5世代Xeon SP（XCCパッケージ）では、SNC2と「Hemi（Hemisphere）」がサポートされる。\n\n 「Hemiって何？」という人もいると思うので解説すると、Hemiは互いのダイのNUMAノードを半分ずつ共有管理する方式だ。SNC2でもHemiでも、メモリアクセス時の伝送経路に大差はないが、LLC（ラストレベルキャッシュ：第5世代Xeon SPの場合はL3キャッシュ）のカバー範囲が大きく変わる。どちらのモードが良いかはサーバの使い方によって変わるため、一概に優劣は付けられない。\n\n なお第5世代Xeon SPは、先述の通りダイ間インターコネクト用の内部バス性能が増強された他、L3キャッシュも増量された。両者の相乗効果により、LCCのミス時とヒット時の両方でメモリアクセスの遅延が低減されている。\n\n 次ページでは、第5世代Xeon SPのラインアップについて見ていこう。\n第5世代Xeon SPのラインアップ\n第5世代Xeon SPの製品ラインアップは以下のようになっている。1ソケット（1S）ソリューションや2ソケット（2S）ソリューションを中心としたモデルのみの提供となっており、これ以上の大規模なマルチソケット（H）システムについては、システムベンダーを通して遅れてリリースされる見通しだ。\n\n 表を見ても分かるように、対応メモリは全てDDR5規格となる。基本的に動作クロックが高いほど、ダイ（あるいはコア）の数が多いほど製品グレードが高まるのは、クライアントPC向けCPUと同様だ。\n\n 近年のXeon SPは、用途別にラインアップが細分化されている。上で示した表でも汎用（はんよう）的な「高性能サーバ用」「標準性能サーバ用」の他、「水冷システム用（Q）」「ネットワークサーバ用（N）」「クラウド事業者用（P／V）」「ストレージサーバ用（S）」や、長期（10年）サポート付きの「基幹サービス用（T）」と、細かく区分されていることが分かる。\n\n 製品リストを見ると「DSA」「IAA」「QAT」「DLB」という項目もあるが、これはCPUに内蔵されているアクセラレーターユニットの基数を表している。これらのアクセラレーターは第4世代から引き続き搭載されているものだが、本稿でも軽く解説しておこう。\n\nDSA：Data Streaming Accelerator\n\n DSAは「Data Streaming Accelerator」で、CPUのロード／ストア命令に成り代わり、主にメモリ間コピーを実践してくれるユニットだ。イメージとしてはDMA（Direct Memory Access）ユニットに近いのだが、DSAはデータの伝送範囲を「CPU～メモリ～キャッシュ」だけでなく、「メモリ～ストレージ～各種PCI Expressデバイス」にまで広げることで汎用性を高めている。\n\n DMAと同じように、DSAを運用するには各種パラメータ設定が必要となる。自動で有効化できるものではないため、活用には一定の技術力や理解力が求められるが、その難易度を下げる目的のプログラムライブラリとして「Intel Media Transport Library（IMTL）」や「Data Plane Development Kit（DPDK）」も提供されている。\n\nIAA：In-Memory Analytics Accelerator\n\n IAAは「In-Memory Analytics Accelerator」の略で、メモリ内容の圧縮／展開／暗号化／復号／フィルタリングを請け負うアクセラレーターだ。製品リストを見ると、ネットワークサーバ向け製品はIAAの搭載数が極端に多い。\n\n IAAの活用目的はいろいろあるが、例えば「悪意のあるプログラムが、標的のプログラムのデータ領域から“生データ”を抜き出しても、全く意味のなさないデータに見せる」といったことができる。制御設定はCPUから行われるが、実務は完全にCPUの手から離れた状態で行われるのは、先に紹介したDSAと同様だ。また、IAAとDSAは連携して使うこともできる。\n\nQAT：Quick Assist Technology\n\n QATは「Quick Assist Technology」の略で、こちらもデータの圧縮／展開／暗号化／復号／フィルタリングを請け負うアクセラレーターとなる。製品リストを見ると、ネットワークサーバ向けモデルはもちろん、ストレージサーバ向けモデルもQATの搭載数が多い。\n\n IAAとの違いだが、IAAはメモリの内容そのものや、メモリアクセスに付随する各種処理系を担うのに対して、QATはアプリが取り扱うデータパッケージに対する処理を担当する。\n\nDLB：Dynamic Load Balancer\n\n DLBは「Dynamic Load Balancer」の略で、多くの場合「特定のCPUコアに負荷が集中することを軽減する機構」だと説明される。ただし、ここでいう「負荷」は演算の負荷ではなく、ネットワーク経由で伝送されるパケットデータを処理する際の負荷を意味する。ゆえに、DLBもネットワークサーバ向け製品やストレージサーバ向けモデルに多く搭載されている。\n\n 100Gbpsクラスのネットワーク処理が特定のCPUコアに一極集中すると、サーバ全体のパフォーマンスに影響する。DLBはこの問題を緩和するために用意されているが、利用するには仮想ドライバの導入と、専用のフロントエンドアプリが必要となる。「あるだけで勝手に恩恵が得られる」というものではないので注意しよう。\n\n 次のページでは、第5世代Xeon SPの特徴をもう少し“深掘り”してみよう。\n第5世代Xeon SPは第4世代からどう変わった？\n先述の通り、第5世代Xeon SPと先代とのアーキテクチャ面での大きな差分は、XCCパッケージのダイ構成が変わったことと、より低消費電力を求めるニーズに応えるべくEE LCCパッケージが追加されたことの2点となる。ここからは、先代との差分をもう少し細かく見ていこう。\n\nCPUコア：L3キャッシュを大きく増量\n\n 第5世代Xeon SPのCPUコアは「Raptor Coveマイクロアーキテクチャ」を採用している。Raptor Coveは、第13世代Coreプロセッサ（開発コード名：Raptor Lake）の高性能コア（Pコア）と同じデザインだ。もっといえば、第12世代Coreプロセッサ（開発コード名：Alder Lake）のPコアで使われている「Golden Coveマイクロアーキテクチャ」の最大稼働クロックを500MHz（0.5GHz）程度引き上げ、CPU命令のプリフェッチを改善した、事実上の「マイナーチェンジ版」ともいえる。\n\n 第5世代Xeon SPでは、CPUコア1基あたり2MBのL2キャッシュが搭載されている。これは第4世代Xeon SP向けGolden Coveと同様なので、改良点とはいえない。注目すべきはLLCことL3キャッシュの容量である。モデルにもよるが先代の最大約3倍に増量されている。\n\n 最大コア数モデル（≒最上位モデル）同士で比較してみると、第4世代の60コアモデル「Xeon Platinum 8490H」のL3キャッシュは112.5MBだったのに対して、第5世代Xeon SPの64コアモデル「Xeon Platinum 8592+」のL3キャッシュは320MBと、増加率は約2.84倍だ。他のモデルも、同クラスの製品で新旧比較すると、おおむねこの率でL3キャッシュの容量が増えた。\n\n 近年、プロセスノードが微細化しても、キャッシュメモリ用のSRAMの微細化は停滞傾向にあるので、「キャッシュの増量に掛かる製造コスト増」と「得られる性能向上率」のバランスは決して芳しくはないはずだ。しかし、「Xeon SPは性能最重要視のサーバ用CPUだから」ということで、こうした設計方針をとったのであろう。\n\n なお、LLCの容量拡大はキャッシュのヒット率向上につながり、ひいてはメインメモリへのアクセスの隠蔽（いんぺい）効率の向上にも結び付く。このことはIPC（クロックあたりの命令実行率）の向上にはつながらないが、低下の抑止（≒IPCの維持）には有効なので、パフォーマンス面で得られる恩恵は大きい。\n\n Intelの調べによると、先代の同ランクモデルとの性能比較では、21％以上の性能向上が確認できたという。\n\nメモリ：より高速なモジュールをサポート\n\n この他、第5世代Xeon SPではサポート可能なDDR5メモリのスピードが全体的に向上した。第4世代は最大で4800MHz（DDR5-4800）までのサポートだったが、第5世代では最大で5600MHz（DDR5-5600）までサポートする。\n\n また、マルチプロセッサ（マルチソケット）運用時の実効性能に大きく影響する、プロセッサ間インターコネクト「UPI（Ultra Path Interconnect） 2.0」の伝送速度も先代毎秒16GTから毎秒20GTへと高められた。\n\n ブロックダイヤグラム（構造図）を見る限り、第5世代Xeon SP（XCCパッケージ）のUPIコントローラ数は4基のままで、UPIのリンク数の増加についても言及がなかった。先代のと同じくリンクが24レーン分あると仮定した場合、マルチプロセッサの相互接続帯域は「毎秒20GTs×24÷8＝毎秒240GB」になると思われる。\n\nその他：消費電力やセキュリティーを改善\n\n 第5世代Xeon SPでは、消費電力（電力効率）についても改良が見られる。\n\n 第4世代と比べると、平常動作モードともいえる「性能優先モード」では、CPU負荷率が30～40％の場合においてわずかだが消費電力が低下する。Intelによると、これを「消費電力優先モード（Optimized Power Mode）」に切り替えると、同じ条件で66～110W程度のさらなる消費電力低減が見込めるとのことだ。\n\n 第5世代Xeon SPは、セキュリティ機能も強化された。\n\n 第4世代Xeon SPでは特定モデルのみ対応していた「Intel TDX（Trust Domain Extensions）」を、第5世代では全モデルでサポートする。\n\n 第4世代以降のXeon SPでは、アプリごとのメモリ空間の隔離／保護を「Intel SGX（Software Guard Extensions）」が担ってきた。SGXと比べると、TDXを使えば隔離／保護単位を仮想マシン（VM）まで広げられる上、隔離／保護機能を利用した際のパフォーマンスの低下が抑えられるという。\n\nCXL 1.1バス：Type 3デバイスの接続も可能に\n\n 一般ユーザー向けのPCでは当面の間関係ないだろうが、サーバ／データセンター向けコンピューターシステムでは「CXL（Compute Express Link）」というバス規格に関する話題が増えてきた。\n\n CXLはPCI Express 5.0をベースに、CPUやメモリ、各種周辺機器においてより高速にデータのやりとりができるようにした規格だ。実用ベースでは「CXL 1.1」が普及しているが、現時点ではPCI Express 6.0も想定した「CXL 3.0」の策定作業も進んでいる。\n\n CXL 1.1では、デバイスを大きく「Type 1」「Type 2」「Type 3」の3種類に分けて定義している。\n\n Type 1は「CPU管理下のメモリ空間にアクセスできるが、自身はCPUと共有するメモリ空間を持たないデバイス」だ。CPUとメモリ空間は共有しないものの、キャッシュメモリの内容の一貫性は担保できるようになっている。対応デバイスの具体例としては、サーバに搭載される「スマートネットワークカード」が挙げられる。\n\n Type 2は「CPUとデバイスがそれぞれにメモリ空間を持ち、CPUからもデバイスのメモリ空間にアクセスできるデバイス」だ。Type 1と同様にキャッシュメモリの内容の一貫性は確保されるが、逆方向（デバイスからCPUのメモリ空間）へのアクセスはサポートされない。サーバ向けGPUは、このタイプのデバイスの代表格となる。\n\n そしてType 3は「CPUからのアクセスを許容するメモリ空間だけを備えるデバイス」である。「何のこっちゃ？」と思うかもしれないが、分かりやすくいえば補助記憶デバイスのために用意されたデバイスタイプとも言い換えられる。メインメモリとストレージデバイスの“間”に差し込んで使う「メモリ拡張デバイス（Memory Expansion Device）」が、本タイプの代表的なデバイスだ。このような性質から、Type 3デバイスは「CXLメモリ」と呼ばれることもある。\n\n 前置きが長くなったが、第5世代Xeon SPはCXL 1.1 Type 1／Type 2デバイスの接続に加えて、CXL 1.1 Type 3デバイス（＝CXLメモリ）の接続にも対応した。\n\n 第5世代Xeon SPでは、CXLメモリに対して2つの接続モードが用意されている。\n\n【2-Tier Memory Support】\n\n 「2-Tier Memory Support」モードでは、CPU直結のDDR5メモリ（最大8チャンネル）を高速な「Tier 1メモリ」、CXL 1.1バス（最大4チャンネル）に接続したCXLメモリを中低速の「Tier 2メモリ」として定義して使える。\n\n リアルタイム性（≒高速なレスポンス）が求められるアプリやデータはTier 1メモリに、そうでもないアプリやデータはTier 2メモリに配置することで、よりメモリをより効率的に利用できる。\n\n【Single Tier Memory Support】\n\n 先に説明した2-Tier Memory Supportモードとは異なり、「Single Tier Memory Support」モードではDDR5メモリとCXL 1.1バスに接続したCXLメモリを“対等に”取り扱う。このモードを使うと、CPU視点では「最大12チャンネルのメモリ」が存在するように見える。\n\n 性質上、このモードではメモリのアクセススピードが遅い方（≒CXLメモリ）に合わせられる。そのため、「メモリのアクセススピードが命」という用途ではパフォーマンスが低下してしまうが、逆に「メモリの容量こそが重要」という用途ではパフォーマンスが向上する。\n\n どちらのモードが有利となるかは、サーバで動かすアプリやサービスによる。CXLメモリを併用する場合は、稼働環境を精査した上でモードを選ぶとよいだろう。\n\n 第5世代Xeon SPでは、AI（人工知能）処理やHPC（ハイパフォーマンスコンピューティング）における演算処理を高速化するための工夫も盛り込まれている。\nAI処理性能が向上した第5世代Xeon SP\n第5世代Xeon SPでは、各種AI処理やHPCに必要な演算処理も向上したのだという。実際のところ、その工夫は結構こまごまとしたものなのだが、端的にいえばSIMD命令を実行する際の動作クロックと消費電力の最適化を一層進めた成果となる。\n\n 「SSE」「AVX2」「AVX512」「AMX」など、SIMD命令にはいろいろな種類があるが、いずれも1つの命令でたくさんのデータを対象とする演算を行う点で共通している。当然だが、命令における演算が複雑であるほど、演算対象のデータ（レジスタ）の数が多いほどに、瞬間的な消費電力をは大きくなる。\n\n 下に示した図にある「Cdyn（Dynamic Capacitance）Class」は消費電力のレベルを召しており、レベルが大きいほど大きい消費電力に対応していることになる。また最下段の「Turbo Freqency」は動作クロックのモードを示しており、右に行くほど控え目なクロックに対応する。各種SIMD命令は、その複雑度に応じて「Ultra Light（超軽量）」「Light（軽量）」「Moderate（普通）」「Heavy（重量）」のランク付けがされている。\n\n つまり、下の図は「SIMDの命令クラス（方式）」と「複雑度のランク」の掛け合わせで、どのCdyn ClassとTurbo Freqencyに属する処理なのかを示す“早見表”となる。\n\n この表を見ると、第4世代ではCydn Class 3に相当する一部のSIMD命令が、第5世代では新設されたCdyn Class 4に位置付けられている。全体的に見るとAVX／AMX系の命令における動作クロックが高くなり、結果として消費電力を抑制できた――そう言いたいようだ。\n激しさを増すサーバ向けCPU戦線にも注目\n第5世代Xeon SPと同時に、Intelはエッジサーバ向けCPU「Xeon D1800／2800シリーズ」と、エントリーサーバ向けCPU「Xeon E-2400シリーズ」も発表している。\n\n Xeon D-1800／2800シリーズは、先代の「Xeon D-1700／2700シリーズ」と同じ「Ice Lake-Dマイクロアーキテクチャ」となっており、基本仕様に大きな変更はない。全12モデル展開で、最大コア数は20基から22基となった。Xeon D-1800シリーズについては、内部に100GBイーサネットコントローラーを2基統合している。\n\n Xeon E-2400シリーズは、マイクロアーキテクチャが「Rocket Lake-E」から「Raptor Lake-E」にアップデートされている。その影響で、メモリはDDR4ベースからDDR5ベースとなり、PCI ExpressバスもPCI Express 5.0にアップデートされている。\n\n サーバ向けCPUの分野において、IntelはAMDの「EPYCシリーズ」と激闘を繰り広げている。\n\n これまで、IntelはAMDに対してCPUコアの数で“劣勢”に立たされてきた。その巻き返し策として、Intelは2024年前半にも高効率コア（Eコア）のみで構成される新型Xeon「Sierra Forest」（開発コード名）を投入する計画だ。\n\n Sierra Forestはダイ1基につきCPUコアを最大144基搭載しており、これを2基連結することで最大288コアのCPUとして登場する見通しだ。ただし、Eコアのみということでハイパースレッディングには対応しておらず、288コア構成の場合、実行できるスレッドはコア数と同じ288個となる。\n\n AMDも負けじと、このSierra Forestの対抗馬として、Zen 5アーキテクチャベースの新型EPYCを開発しているとされる。うわさレベルだが、この新型EPYCは192コア384スレッド以上で登場するという話もあり、これからはコア数とスレッド数の“えげつない戦争”が繰り広げられそうで、それはそれで面白そうだ。\nITmedia PC USER,['https://newsatcl-pctr.c.yimg.jp/t/amd-img/20231229-00000045-zdn_pc-000-1-view.jpg?exp=10800'],"['https://news.yahoo.co.jp/articles/44052e0531e2693572a2ba82d9c737d3a9babf39/images/000', 'https://image.itmedia.co.jp/l/im/pcuser/articles/2312/28/l_si7101-Xeon-07.jpg#utm_source=yahoo_v3&utm_medium=feed&utm_campaign=20231229-045&utm_term=zdn_pc-prod&utm_content=img']"
